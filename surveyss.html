<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Surveying the Solar System</title>
  <meta name="description"
    content="How to survey the solar system using only naked-eye observations.">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script>MathJax = {tex: { inlineMath: [["$", "$"], ["\\(", "\\)"]] }};
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"
          id="MathJax-script">
  </script>
  <style>
    /* @import url('https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;0,900;1,300;1,400;1,700;1,900&family=Roboto:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap'); */
    @import url('https://fonts.googleapis.com/css2?family=Merriweather+Sans:ital,wght@0,400;0,700;1,400;1,700&family=Merriweather:ital,wght@0,400;0,700;1,400;1,700&display=swap');

    body {
        margin: 0;
        padding: 0;
        font-family: 'Merriweather', serif;
        /* font-family: 'Merriweather Sans', sans-serif; */
    }

    .unselectable {
        -webkit-user-select: none; /* Safari */
        -ms-user-select: none; /* IE 10 and IE 11 */
        user-select: none; /* Standard syntax */
    }

    #intro {
        width: 100%;
        height: 100%;
        padding: 7%;
        margin: 0;
        transform: translate(0, 0);
        box-sizing: border-box;
        background: #eeec;
        transition: transform 0.3s;
    }
    #intro ul {
        list-style-type: none;
        font-family: 'Merriweather', serif;
        font-weight: normal;
        font-size: 23px;
        height: 95%;
        padding: 10px;
        margin: 0;
        border: 4px solid darkslategray;
        border-radius: 1em;
        background: #fffb;
    }
    #intro ul li {
        padding: 1ex 0ex;
    }

    #intro .close-x {
        position: absolute;
        top: 10px;
        right: 6px;
    }
    .close-x {
        position: relative;
        width: 40px;
        height: 30px;
        cursor: pointer;
    }
    .close-x::before, .close-x::after {
        content: " ";
        display: block;
        position: absolute;
        left: 0;
        top: 12px;
        height: 6px;
        width: 100%;
        border-radius: 6px;
        background-color: darkslategray;
    }
    .close-x::before {
        transform: rotate(45deg);
    }
    .close-x::after {
        transform: rotate(-45deg);
    }

    .hidden {
        display: none;
    }
    #main-hamburger {
        position: absolute;
        top: 10px;
        right: 10px;
        z-index: 99;
        background: white;
    }
    #main-hamburger:not(.holding).open {
        background: navajowhite;
    }
    .hamburger-x {
        width: 40px;
        height: 30px;
        position: relative;
        transform: rotate(0deg);
        transition: transform .5s ease-in-out, background .5s ease-in-out;
        cursor: pointer;
    }
    .hamburger-x span {
        display: block;
        position: absolute;
        height: 6px;
        width: 100%;
        background: darkslategray;
        border-radius: 6px;
        left: 0;
        transform: rotate(0deg);
        transition: .25s ease-in-out;
    }
    .hamburger-x span:nth-child(1) {
        top: 0px;
    }
    .hamburger-x span:nth-child(2), .hamburger-x span:nth-child(3) {
        top: 12px;
    }
    .hamburger-x span:nth-child(4) {
        top: 24px;
    }
    .hamburger-x.open span:nth-child(1) {
        top: 12px;
        width: 0%;
        left: 50%;
    }
    .hamburger-x.open span:nth-child(2) {
        transform: rotate(45deg);
    }
    .hamburger-x.open span:nth-child(3) {
        transform: rotate(-45deg);
    }
    .hamburger-x.open span:nth-child(4) {
        top: 12px;
        width: 0%;
        left: 50%;
    }

    #top-div {
        width: 100%;
        display: flex;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    .left-wrapper {
        box-sizing: border-box;
        margin: auto;
        flex: 1 1 100%;
        display: flex;
        overflow: auto;
    }

    .left-panel {
        box-sizing: border-box;
        min-width: 450px;
        max-width: 750px;
        margin: auto;
        position: relative;
        flex: 1 1 0;
        opacity: 1;
        transition: opacity 0.3s;
    }
    .left-panel.faded {
        opacity: 0;
    }

    .right-panel {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        transform: scale(1);
        transition: all 0.3s;
        min-width: 450px;
        max-width: 750px;
        margin: auto;
        position: relative;
        flex: 1 1 0;
    }
    .right-panel.shrunken {
        transform: scale(0);
        min-width: 0px;
        max-width: 0px;
        margin: 0;
    }

    .panel-title {
        box-sizing: border-box;
        text-align: center;
        display: block;
        margin: 0;
        padding: 10px 0 0 0;
        height: 30px;
        font-family: 'Merriweather Sans', sans-serif;
        font-size: 28px;
    }

    .sidebar {
        flex: 1 0 auto;
        box-sizing: border-box;
        background: navajowhite;  /* wheat, moccasin, beige, seashell */
        color: slategray;
        margin: 0 auto;
        padding: 30px 0 0 0;
        font-family: 'Merriweather Sans', sans-serif;
        font-size: 135%;
        white-space: nowrap;
        overflow: hidden;
        width: 0;
        transition: width 0.3s;
    }
    .sidebar.open {
        width: 10em;
        transition: width 0.3s;
    }
    .sidebar ul {
        list-style-type: none;
        padding: 0.25ex 0 0 0;
        margin: 1em;
        border-top: 6px solid darkslategray;
    }
    .sidebar ul li:not(.separator) {
        padding: 0.25ex 0 0.25ex 0;
    }
    .sidebar ul li:not(.current, .separator):hover {
        padding: 0.25ex 0 0.25ex 0;
        background: #fdf8e0;  /* oldlace #fdf5e6 */
        color: black;
        font-style: italic;
        font-weight: bold;
        cursor: pointer;
    }
    .sidebar ul li.current {
        font-style: italic;
        background: #fb0;
        color: black;
    }
    .sidebar ul li.separator {
        width: 100%;
        height: 0.2ex;
        background: darkslategray;
    }
    .sidebar ul li.usage {
        text-align: center;
        font-style: italic;
        background: #fb0;
        color: black;
    }

    #main-overlay {
        box-sizing: border-box;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        background: white;
        opacity: 0.95;
        transition: opacity 0.5s;
    }
    #main-overlay.faded {
        opacity: 0;
        z-index: 20;
    }
    .helper {
        min-width: 400px;
        max-width: 750px;
        margin: 0 auto;
        padding: 0 10px 20px;
        font-size: large;
    }
    .helper h1 {
        -webkit-user-select: none; /* Safari */
        -ms-user-select: none; /* IE 10 and IE 11 */
        user-select: none; /* Standard syntax */
        font-family: 'Merriweather Sans', sans-serif;
        font-size: 24pt;
        color: darkslategray;
        text-align: center;
    }
    .helper hr {
        margin: 4px 0;
        height: 3px;
        background: darkslategray;
    }
    .question, .helper h1 span {
        -webkit-user-select: none; /* Safari */
        -ms-user-select: none; /* IE 10 and IE 11 */
        user-select: none; /* Standard syntax */
        box-sizing: border-box;
        border: 2px solid black;
        border-radius: 8px;
        margin: 4px 0;
        padding: 2px 5px;
        color: black;
        background: #fdf8e0;
        font-family: 'Merriweather Sans', sans-serif;
        cursor: pointer;
    }
    .helper h1 span {
        margin: 0 8px;
        padding: 0 5px;
    }
    .question:hover {
        background: navajowhite;
        font-style: italic;
        font-weight: bold;
    }
    .answer {
        box-sizing: border-box;
        padding: 0 5px;
        font-family: 'Merriweather', serif;
        overflow: hidden;
        max-height: 0;
    }
    .answer.active {
        max-height: 100%;  /* this does not work quite right */
    }

  </style>
</head>

<body>

  <div id="top-div">
    <div id="main-hamburger" class="hamburger-x hidden"
         onclick="openSidebar()">
      <span></span><span></span><span></span><span></span>
    </div>
    <div class="left-wrapper">
      <div id="top-clock" class="left-panel unselectable">
        <!-- The intro will be moved into the clock svg in javascript below.
             Because this is the landing page for the whole site, we want
             the text to scale with the changing size of the clock svg.
          -->
        <div id="intro">
          <!-- 20pt font optimal for chrome, 18pt for firefox -->
          <ul>
            <li style="padding: 1ex 0ex;">This &ldquo;planet
              clock&rdquo; shows the positions of the Sun and planets
              as they move through the constellations of the Zodiac
              <a href="https://ssd.jpl.nasa.gov/planets/approx_pos.html">for
                any date</a> between 5000 years ago and 1000 years
                from now.</li>
            <li style="padding: 1ex 0ex;">You can watch the Sun and
              planets move through the stars, just as you can by
              looking at the sky with your own eyes.
            </li>
            <li style="padding: 1ex 0ex;">Do you see evidence that the
              planets orbit the Sun and not the Earth?  That Earth is
              the third planet?  Can you figure out the order of the
              planets from the Sun?  How would you test these
              ideas?</li>
          </ul>
          <div class="close-x" onclick="removeIntro()">
          </div>
        </div>
      </div>
      <div id="first-two-l" class="left-panel unselectable faded hidden">
        <div class="panel-title">Fit Ellipse to Orbit</div>
      </div>
      <div id="third-law-l" class="left-panel unselectable faded hidden">
        <div class="panel-title">Fit Other Orbits</div>
      </div>
      <div id="orbit-view" class="right-panel unselectable shrunken hidden">
        <div class="panel-title">Picture Planetary Orbits</div>
      </div>
      <div id="earth-year" class="right-panel unselectable shrunken hidden">
        <div class="panel-title">Find Earth Period</div>
      </div>
      <div id="mars-year" class="right-panel unselectable shrunken hidden">
        <div class="panel-title">Find Mars Period</div>
      </div>
      <div id="surveyor" class="right-panel unselectable shrunken hidden">
        <div class="panel-title">Survey Earth &amp; Mars Orbits</div>
      </div>
      <div id="incline" class="right-panel unselectable shrunken hidden">
        <div class="panel-title">Find Mars Inclination</div>
      </div>
      <div id="first-two-r" class="right-panel unselectable shrunken hidden">
        <div class="panel-title">Area-Time Relation</div>
      </div>
      <div id="third-law-r" class="right-panel unselectable shrunken hidden">
        <div class="panel-title">Period-Distance Relation</div>
      </div>
    </div>
    <div id="main-sidebar" class="sidebar unselectable">
      <ul>
        <!-- https://datacadamia.com/web/dom/event/on_content_attribute
             has information on what can go in the onclick string.
             The "this" argument means the element for onclick,
             the "event" argument is the event.  However, it's a little
             unclear how universal this is, and there is very little
             information about exactly what can go in the onclick string.
          -->
        <li onclick="usageClick(this)" class="usage">Tips &amp; Queries</li>
        <li class="separator"></li>
        <li onclick="clockClick(this)" class="current"
            data-id="top-clock">Planet Clock</li>
        <li onclick="earthClick(this)" data-id="earth-year">Earth Period</li>
        <li onclick="orbitClick(this)" data-id="orbit-view">Orbit View</li>
        <li onclick="marsClick(this)" data-id="mars-year">Mars Period</li>
        <li onclick="surveyClick(this)" data-id="surveyor">Survey Orbits</li>
        <li onclick="inclineClick(this)" data-id="incline">Mars Inclination</li>
        <li onclick="twoClick(this)" data-id="first-two-r">First Two Laws</li>
        <li onclick="thirdClick(this)" data-id="third-law-r">Third Law</li>
      </ul>
    </div>
  </div>
  <div id="main-overlay" class="faded hidden">
    <div id="top-clock-help" class="helper">
      <h1>Tips &amp; Queries: Planet Clock<span>&gt;</span></h1>
      <div class="question">Why should we study how the planets move?</div>
      <div class="answer">
        <p>Because working out the answer to this question triggered
          the scientific revolution that built our modern world.</p>
        <p>Everyone who looks up at night must wonder what they are
          looking at, and what this view we have tells us about where
          we are standing.  Aside from the occasional comet or nova,
          the view never changes - as if a cartographer had painted a
          gigantic map on the sky...</p>
        <p>With exactly seven exceptions: The Sun, the Moon, and five
          wandering stars - the planets.  (The planets Uranus and
          Neptune are too faint for the unaided human eye to see, as
          are the dwarf planets and asteroids.)  Most people will only
          notice the motion of the Sun, because that gives rise to the
          seasons.  If you live near the sea, you might also notice
          the motion of the Moon, because it affects the tides.  The
          motions of the planets have no effect whatsoever on our
          world.</p>
        <p>This &ldquo;planet clock&rdquo; is a very accurate
          ephemeris, which shows you exactly where the Sun and planets
          are relative to the fixed constellations of stars on any
          given date.  Since those motions are the only changes in the
          sky you can see with your own eyes, you have before you a
          tolerably complete summary of every observation of the sky
          in recorded history prior to 1609, when Galileo invented the
          telescope.  You can go outside on any clear night and check
          what this clock says with your own eyes.</p>
        <p>By an odd coincidence, in 1609 Kepler published his first
          two laws of planetary motion - which were therefore entirely
          based on naked-eye data you can recreate for yourself here.
          In other words, the puzzle of planetary motion and the basic
          structure of our solar system was solved using only the
          information here before you.  Can you do what Kepler
          did?</p>
      </div>
      <div class="question">How does the &ldquo;planet clock&rdquo;
        chart the sky?</div>
      <div class="answer">
        <p>The Sun follows a great circle around
          the <a href="https://en.wikipedia.org/wiki/Celestial_sphere">
          celestial sphere</a> during the course of a year.  The
          constellations of the zodiac lie around this circle, serving
          as convenient markers that you can learn to recognize when
          you look at the night sky.  The plane of this great circle
          (or sometimes the circle itself) is called the ecliptic.</p>
        <p>The black outer ring of the &ldquo;planet clock&rdquo;
          represents a ribbon of sky arond the ecliptic: The gray
          circle at the center of the ring is the ecliptic itself;
          points outside this circle are north of the ecliptic in the
          sky, while points inside the circle are south of the
          ecliptic.  The ribbon extends 9 degrees north and south, and
          gray circles are drawn 5 degrees north and south of the
          ecliptic.</p>

        <div style="min-width: 300px; max-width: 700px; padding: 10px;">
          <img src="planetclock.svg" style="width: 100%"
               alt="picture of ecliptic coordinate system" />
        </div>

        <p>The dashed radial lines show the astronomical boundaries of
          the constellations of the zodiac standardized by the IAU in
          1928.  The constellation names appear between these dashed
          lines, tying the black ring to what you see in the sky.
          (The boundaries drawn here for Scorpio include the
          constellation Ophiuchus, whose 1928 boundary intersects the
          ecliptic even though it is not one of the ancient twelve.)</p>
        <p>The solid radial lines marked every 30 degrees around the
          ecliptic show
          <a href="https://en.wikipedia.org/wiki/Ecliptic_coordinate_system">
            J2000 ecliptic longitude</a>.  The gray circles mentioned
          above are J2000 ecliptic latitude lines (including the
          ecliptic, which is ecliptic latitude 0.).  The J2000
          coordinates are fixed relative to the stars, so the planet
          clock shows how the Sun and planets move relative to the
          fixed stars.  The clock shows how the positions of the Sun
          and planets move through the fixed constellations through the
          years.  The gold clock hand shows the longitude of the Sun,
          that is its position in the zodiac.  A fainter gold hand
          shows the longitude exactly opposite the Sun.  You can toggle
          on additional hands for the planets.</p>
        <p>You can also toggle on the Moon.  However, the motion of
          the Moon only relates very subtly to the motions of the
          Sun and planets, and has nothing to do with the topics
          discussed here.</p>
        <p>You can see everything depicted on the planet clock with
          your own eyes by looking at the night sky.  The partial
          exception is the Sun - you also need a good timepiece to
          work out where the Sun is in the sky because you can never
          see the Sun and stars together in the sky!  The sky blue
          sector interrupting the black ring very roughly indicates
          the part of the sky which is too close to the Sun to see any
          stars or planets located there.  (The exact extent of the
          part of the sky obscured by daylight depends on your
          latitude and the time of year.)  The side of the blue sector
          labeled "evening" are stars setting too soon after sunset to
          be seen; the side labeled "morning" are stars which do not
          rise early enough before sunrise to be seen.</p>
        <p>One final point of interest: If you set the clock forward
          or backward by many centuries (try the year -3000, 5
          millenia ago) you will notice that the gray ring labelling
          the months has rotated.  The months (in our Gregorian
          calendar) are tied to the seasons - for example the spring
          equinox is always close to March 20.  The rotation of the
          month dial is caused by the very slow precession of the
          Earth's spin axis relative to the constellations, the
          precession of the equinoxes.</p>
      </div>
      <div class="question">How do the controls work?</div>
      <div class="answer">
        <ol>
          <li>Drag Sun around sky ring to set date.</li>
          <li>Click year button to set year (accurate from -3000 to 3000).</li>
          <li>Press and hold triangles below sky ring to animate.</li>
          <li>Click legend symbol or planet name to toggle radial line.</li>
          <li>Click Show/Hide Moon button to toggle Moon.</li>
        </ol>
      </div>
      <hr/>  <!-- following dummy answer fixes spacing after this hr -->
      <div class="answer"></div>
      <div class="question">Do you see evidence that the
        planets orbit the Sun and not the Earth?</div>
      <div class="answer">
        <p>You can quickly see that the motion of the planets is
          <em>connected to</em> the motion of the Sun: Toggle on a
          planet line by clicking on its name in the legend, then
          press and hold one of the triangle animation buttons on the
          lower right.  Mercury and Venus wag back and forth about the
          Sun, never straying far from it.  Mars, Jupiter, and Saturn
          move around the zodiac in the same direction as the Sun but
          more slowly, so at first you may not see their relationship
          to the Sun.</p>
        <p>If you watch more carefully, however, you notice that Mars,
          Jupiter, and Saturn reverse direction whenever they are near
          opposition to the Sun - the light gold line opposite the Sun
          hand of the planet clock.  Mercury and Venus also reverse
          direction as they pass from the evening to the morning side
          (they are moving the same direction as the Sun as they move
          from the morning side to the evening side).  In all cases,
          the retrograde motion of a planet around the zodiac is
          tied to the position of the Sun.</p>
      </div>
      <div class="question">Do you see evidence that
        Earth is the third planet?</div>
      <div class="answer">
        <p>For Mercury and Venus, you get a strong impression that you
          have an edge-on view of roughly circular orbits around the
          Sun, and the size of those orbits is less than your distance
          from the Sun.  Note that they spend far less time going from
          evening to morning than from morning to evening, as they
          would if they were moving around the Sun in the same
          direction as the Sun is moving around the zodiac.  The
          evening to morning transit is in front of the Sun, while the
          morning to evening transit is behind the Sun.</p>
        <p>For Mars, Jupiter, and Saturn, you might try thinking about
          how Earth would look if you were on Venus.  The direction to
          Earth from Venus is exactly 180 degrees from the direction
          you see Venus from Earth, so the path Earth follows through
          Venus's sky is exactly the reverse of the path we see Venus
          follow.  However, when Venus passes between Earth and Sun,
          Earth appears at opposition from Venus.  That is why Mars,
          Jupiter, and Saturn move retrograde near oppositon - their
          large orbits take them behind you.</p>
        <p>Since you can see that the orbits of Mercury and Venus are
          smaller than your distance to the Sun, while the orbits of
          Mars, Jupiter, and Saturn are larger, Earth must be third in
          order from the Sun.</p>
      </div>
      <div class="question">Can you figure out the order
        of the planets from the Sun?</div>
      <div class="answer">
        <p>The farthest Mercury or Venus gets from the Sun is called
          its <em>maximum elongation</em>.  You can see that Mercury
          has a smaller maximum elongation than Venus, so its orbit
          must be smaller.  Earth must come third because when the
          others are at opposition, you are between them and the
          Sun.</p>
        <p>Mercury also moves faster than Venus and Venus moves faster
          than the Sun (that is, Earth).  Mars moves around the sky
          slower than the Sun (Earth), Jupiter slower still, and
          Saturn slowest of all, so if the rule that closer orbits are
          faster holds, then that is their order in distance from the
          Sun.</p>
        <p>Without the faster-is-closer rule, ordering the planets
          beyond Earth by distance is much harder.  You need the
          quantitative surveying techniques you will learn later to
          make much progress in measuring the geometry of the orbits
          of Mars, Jupiter, and Saturn.</p>
        <p>However, laws like faster-is-closer will always play a
          central role in understanding the positions of planets.
          When you try to chart the solar system, spatial geometry is
          important, but unless your chart shows how the positions of
          the planets change it will be useless.</p>
      </div>
      <div class="question">How would you test these ideas?</div>
      <div class="answer">
        <p>You can work through the sections in the sidebar menu on
          the left from top to bottom to learn how Johannes Kepler
          tested the hypothesis that the planets orbit the Sun.</p>
        <p>Kepler's brilliant insight was that if the planets move
          around the Sun in <em>periodic</em> orbits - that is,
          tracing the exact same loop at the exact same rate every
          revolution - then you can use them as a surveyor uses
          landmarks to work out their relative distances (which you
          cannot see directly).  He is best remembered for fitting his
          surveyed orbits to formulate his three laws of planetary
          motion, but astronomers had been fitting orbits to
          observations for millenia.  Using surveying techniques to
          map the planets is the crucial original leap Kepler
          made.</p>
      </div>
    </div>
    <div id="earth-year-help" class="helper hidden">
      <h1>Tips &amp; Queries:
        <span>&lt;</span>Earth Period<span>&gt;</span></h1>
      <div class="question">
        What does the plot in the right panel show?</div>
      <div class="answer">
        <p>To see the plot, you first need to set a start date using
          the planet clock, then click the Reset button in the planet
          clock dial.  This generates an idealized set of 736 virtual
          "observations" of the position of the Sun over a span of 10
          years, that is, one observation every 5 days.  Apart from
          the equal spacing, this is not an unreasonable amount of
          data for a dedicated observer or team of observers.  Each
          "observation" consists of an exact time and ecliptic
          longitude of the Sun at that time.  The accuracy achieved by
          Tycho Brahe for this kind of naked-eye measurement was about
          10 seconds in time and 1/30 degree in angle, and Kepler
          required this level of accuracy to do his surveying.</p>
        <p>The plot shows a blue line through these data.  The x-axis
          is the ecliptic longitude in revolutions (1 rev = 360
          degrees), with 0 placed at the longitude of the first
          observation.  The y-axis is time elapsed since the first
          observation in days.  A gold circle is drawn at the location
          of the date currently shown on the planet clock, so by running
          the planet clock forward or back you can see which point on
          the blue line corresponds to which observation date.</p>
        <p>Each yellow box shows the data collected in one year.  The
          width of the boxes is always exactly one revolution.  Your
          goal is to measure as accurately as possible the number of
          days required for the Sun to complete one revolution.  The
          height of the boxes is your current estimate of that period.
          You can adjust your estimate by dragging the slider on the
          right edge of the panel up or down.  The yellow line is the
          diagonal of all the boxes (which are stacked corner to
          corner), so you want to adjust your period estimate to make
          the straight yellow line coincide with the blue data line as
          best you can.</p>
        <p>To be able to make a more accurate estimate, click the
          lower triangle button to zoom in.  This will make ten copies
          of the data, and shift each of the ten copies so a different
          one of the boxes overlays the box in the lower left corner.
          The x-axis now shows only one revolution and the y-axis
          shows only one year.  Drag the slider up or down to an
          incorrect year estimate to see how the blue lines fail to
          repeat if your period estiamte is incorrect.  Run the planet
          clock to see how the Sun marker follows the blue lines from
          one year to the next.  After you are satisfied you
          understand this stacked plot of your ten years of data, you
          can again adjust your year estimate as accurately as
          possible.</p>
        <p>Although this plot faithfully depicts all your data, it
          does not yet make the really interesting details visible.
          Ancient astronomers realized that a better way to present
          this kind of data was to think about the difference between
          the blue data line and the straight yellow diagonal line.
          They called the yellow line the motion of the "mean Sun" - a
          theoretical point in the sky which moves around the sky on
          the same path as the Sun but at a constant rate.  Notice
          that the motion of the mean Sun depends on your best
          estimate of the period - you can change it by dragging the
          slider.  By subtracting the time the mean Sun reached any
          position from the time the Sun actually arrived there, you
          can get a far more accurate picture of what your data is
          telling you.  Click the zoom in button a second time to see
          that picture.</p>
        <p>You see that the blue data line is not quite straight - it
          deviates from the straight yellow mean Sun line by about 4
          days over the course of the year.  That is, the Sun does not
          move at a constant rate around the ecliptic, but speeds up
          and slows down in a regular, repeatable way.  At this
          highest zoom level, you can refine your period estimate to
          within about 0.001 day (with ten years of data) - about a
          minute and a half.</p>
      </div>
      <div class="question">How do the controls work?</div>
      <div class="answer">
        <ol>
          <li>Use planet clock controls to set starting date.</li>
          <li>Click Reset button (in planet clock dial) to collect ten
             years of Sun position data.</li>
          <li>Click lower triangle (in upper left corner) to zoom in plot.</li>
          <li>Click upper triangle (in upper left corner) to zoom out plot.</li>
          <li>Drag slider (along right edge) up or down to change your
            estimate of Earth's orbital period.</li>
        </ol>
      </div>
      <hr/>
      <div class="answer"></div>  <!-- do not remove dummy answer -->
      <div class="question">
        What feature strikes you most about the motion of the Sun?</div>
      <div class="answer">
        <p>The most striking thing about the motion of the Sun is how
          precisely it repeats every year.  Here you can check that
          the Sun returns to exactly the same place in the zodiac
          every 365.256 days - to within 0.001 day (a minute and a
          half)!  That's 3 parts per million (or better, as far as you
          can tell with naked eye measurements)!  No natural
          phenomenon on Earth recurs nearly that precisely - in fact,
          until the last century or two, no human contrivances had
          that kind of precision.</p>
        <p>What is perhaps even more impressive - and important - is
          that this motion is not quite uniform.  The Sun is speeding
          up and slowing down as it moves through the constellations
          in exactly the same pattern over and over again.  Ancient
          astronomers understood this marvelous fact very well.  The
          combination of exact periodicity and non-uniformity hints at
          some great underlying regularity.  Newton finally explained
          this ancient mystery by recognizing the law of universal
          gravity, but that is a story for another place.  Here you
          will focus on simply describing this periodic motion in as
          simple, accurate, and general a way as possible.</p>
        <p>Since the apparent diameter of the Sun in the sky remains
          constant, at least as far as you can tell using naked-eye
          observations, you know that the distance from the Earth to
          the Sun must change very little, if at all, during the
          course of the year.  However, remember how nearly straight
          the blue data line appeared on the two lower magnification
          levels in the right panel.  Is it possible that the distance
          to the Sun is changing by a similar tiny amount as it moves
          around the sky?</p>
        <p>If the distance to the Sun is changing slightly during the
          year, the precise periodicity of its motion around the sky
          strongly suggests that any distance changes are also
          periodic, repeating exactly every year.  In other words,
          periodicty in the motion around the sky strongly suggests
          that the Sun is moving around the Earth (or vice versa)
          along a closed path in space, like a train around a fixed
          track on an unvarying schedule.</p>
      </div>
      <div class="question">
        What does the periodicity of the Sun suggest about planetary
        motion?</div>
      <div class="answer">
        <p>What do you mean when you say that the planets all move
          around the Sun and that the Earth is the third planet?
          Besides giving a vague description of the geometry of the
          solar system, you must be saying that if you could view the
          solar system from the Sun, the planets would all move around
          the zodiac in a similar manner.  You mean that the planets
          are somehow alike in their motion around the Sun.  And if
          the Earth is just another planet (in this respect), you are
          saying you know one example of whatever this general kind of
          motion may be: You know exactly how the Earth appears to
          move around the zodiac as viewed from the Sun, because it is
          the same as the motion of the Sun you have measured from
          Earth, only rotated 180 degrees.</p>
        <p>Thus, from the striking periodicity of the Sun's motion,
          the Earth pretty certainly moves in a closed path around the
          Sun at a not-quite-uniform but precisely repeating rate.
          And if the motion of the other planets is somehow similar to
          Earth's, surely this must be the general rule: The planets
          all move in periodic closed orbits around the Sun.  Another
          way to think about it is that, when viewed from any planet,
          the Sun will exhibit the same perfectly periodic motion
          around the zodiac that you see from Earth.</p>
        <p>But this periodic closed orbit hypothesis is an idea you
          can test by carefully studying your planetary position data!
          If it is true, then any planet returns to exactly the same
          point on its orbit after exactly one of its periods.  That
          implies a certain relationship between observations made on
          dates spaced by one period in time, and you can check
          whether your observations are, in fact, so related.  Like
          any hypothesis, checking this is not mathematical proof that
          the hypothesis is true, but it is an extremely strong
          argument in favor.</p>
      </div>
    </div>
    <div id="orbit-view-help" class="helper hidden">
      <h1>Tips &amp; Queries:
        <span>&lt;</span>Orbit View<span>&gt;</span></h1>
      <div class="question">
        What does the diagram in the right panel show?</div>
      <div class="answer">
        <p>The diagram shows three different pictures or paradigms for
          the solar system.  In all cases, you are viewing the
          ecliptic plane from a position far from the solar system in
          the direction of the north ecliptic pole.</p>
        <p>The heliocentric picture is the modern accepted model of
          the solar system, as put forward by Copernicus and surveyed
          by Kepler.  The Sun is at the center, and the planets move
          around it in closed orbits.</p>
        <p>The geocentric picture was proposed by Tycho.  It is
          identical to the heliocentric picture, except the Earth is
          translated to remain stationary at the center, forcing the
          Sun to move around it.  All of the closed planetary orbits
          remain centered on the now moving Sun.  The gold orbit of
          the Sun around the Earth is identical to the blue orbit of
          the Earth around the Sun in the heliocentric picture, except
          it is rotated 180 degrees.</p>
        <p>The epicycle picture is a modifed version of the ancient
          Greek solar system described in Ptolemy's Almagest but
          dating from much earlier.  The modification here is to set
          the arbitary scale factors and change the epicycle shapes
          slightly (from circles to ellipses), so that this epicycle
          picture is geometrically identical to the geocentric
          picture.  However, the model retains all of the key
          geometrical features of Greek epicycle models.  For Mercury,
          Venus, and the Sun, the epicyle picture is identical to the
          geocentric picture.  For Mars, Jupiter, and Saturn, the
          planetary orbit path has been moved from the Sun to the
          Earth.  A new radial line is drawn from the Earth to a pont
          on the planet orbit, and a copy of the gold Sun orbit is
          centered at the end of this radial line.  Each planet now
          moves around a small circle - its epicycle - centered on a
          larger circle centered on the Earth.</p>
        <p>The three pictures are indistinguishable, in the sense that
          the relative positions of the Sun and planets are exactly
          the same in all three pictures.  The only differences are
          the imaginary orbit tracks and radial lines, and which point
          is made stationary at the center of the picture.  There is
          no observational way to distinguish among them.</p>
        <p>Turn on at least one radial line on the planet clock, then
          run the clock forward to watch the observed positions of the
          planets.  Notice that the directions of the Earth-planet and
          Earth-Sun lines that you observe on the sky in the left
          panel are always identical to their directions in the right
          panel, no matter which model you select.  In other words,
          all three provide successful descriptions of how the planets
          move.  You cannot decide which picture is best on the basis
          of how well it matches your data.</p>
        <p>Notice that in the epicycles picture, a faint point and
          line appear on the planet clock for Mars, Jupiter, or
          Saturn.  This is the direction from the Earth to the
          imaginary point at the center of the epicycle (the gold copy
          of the Sun's orbit).  If you run the clock forward, you will
          see that the outer planets wag back and forth around this
          epicycle center point in exactly the same way that Mercury
          and Venus wag back and forth around the Sun: The epicycle
          center moves around the zodiac smoothly; the planet slowly
          overtakes it prograde, then quickly crosses back over it
          retrograde.</p>
        <p>You still haven't figured out how to construct any of the
          orbital shapes needed to make them work perfectly like you
          see here!  These are the dreams; when you've understood
          where you would like to go, you need to wake up and get to
          work!</p>
      </div>
      <div class="question">How do the controls work?</div>
      <div class="answer">
        <ol>
          <li>Click upper triangle (in upper left corner) to zoom out view.</li>
          <li>Click lower triangle (in upper left corner) to zoom in view.</li>
          <li>Click heliocentric/geocentric/epicycles button to change
            pictures.</li>
        </ol>
        <p>Zoom in all the way to watch the inner planets in the
          heliocentric picture.  Zoom out one step to watch the inner
          planets in the geocentric or epicycles picture.  Zoom out a
          second step to watch Jupiter (in any picture).  Zoom out all
          the way to watch Saturn.</p>
      </div>
      <hr/>
      <div class="answer"></div>  <!-- do not remove dummy answer -->
      <div class="question">
        What do you like about the heliocentric picture?</div>
      <div class="answer">
        <p>When you adopt the heliocentric picture, you are likely to
          guess that the motion of the planets as viewed from the Sun
          has the same crucial property as the motion of the Sun as
          viewed from Earth: that every planet, like Earth, travels
          periodically along a closed path around the Sun.  If this
          hypothesis is true, then you can survey the solar system to
          find the shapes of all the orbits and how each planet speeds
          up and slows down as it moves around its orbit.  The
          heliocentric picture strongly suggests a surveying model you
          can test.</p>
        <p>Of course, whatever test you devise will also confirm the
          other two pictures, since they are geometrically equivalent.
          However, by demoting the Earth from its central position and
          supposing it to behave like just another planet, you've
          already suggested that the orbits of the other planets should
          be periodic closed loops around the Sun.  When the Earth was
          different from the other planets, the assumption that their
          orbits around the Sun resemble the Sun's orbit around the
          Earth in this way feels like a separate hypothesis.</p>
        <p>A second reason to believe that the Sun should be at the
          center is that you know it is far, far larger than the Earth
          or any other planet.  The planets always appear as starlike
          points, while you can see the disk of the Sun in the
          sky.</p>
      </div>
      <div class="question">
        What do you like about the geocentric picture?</div>
      <div class="answer">
        <p>You might be attracted to the geocentric picture because it
          makes the relationship between the radial lines you actually
          observe on the planet clock and the radial lines in the map
          of the ecliptic plane really obvious.  Wherever you are, you
          are always at the point from which all your sight lines
          emanate.  Putting the Earth at the center plays into that
          perceptual truth.</p>
        <p>Tycho had an interesting technical reason for believing
          that the Earth is stationary, while the Sun and planets
          orbit it: If the Earth moves around the Sun, then by
          observing the positions of the stars very carefully, you
          should be able to detect slight changes in the shapes of the
          constellations as we view them from different perspectives.
          Despite his best efforts, however, he could not detect any
          such stellar parallaxes.  He calculated that the stars must
          therefore be at least several thousand times farther away
          than the Sun.  He reasoned that this vast difference in
          scale between the distance to the planets and the distance
          to the stars was even less likely than the Earth being
          stationary.  But the universe holds many surprises.</p>
      </div>
      <div class="question">
        What do you like about the epicycles picture?</div>
      <div class="answer">
        <p>The epicycles picture was the backbone of astronomy for
          over two millenia, accepted by nearly all the most brilliant
          ancient Greek and medieval Islamic astronomers.  You see
          here that their model can be adjusted to be equivalent to
          our modern heliocentric picture, so they certainly were not
          completely on the wrong track.  It was a very successful
          descriptive model even in its imperfect forms, and it's hard
          to argue with success.</p>
        <p>The original geometric attraction to the epicycle picture
          is that Mercury and Venus are pretty clearly moving around
          the Sun as the Sun moves around the zodiac.  That is, they
          are moving around a circle whose center is in turn moving
          around us.  This kind of motion is much easier to visualize
          when the radius of the epicyle is less than the radius of
          its center.  The geocentric picture features epicycle
          descriptions of Mars, Jupiter, and Saturn, but the epicycle
          radius is larger than the radius its center moves around
          (the Sun, as for Mercury and Venus).</p>
        <p>Probably, the ancient Greek geometers realized that you can
          get exactly the same motion by swapping the big circle and
          the small circle, so that the small one - in this case the
          orbit of the Sun - becomes the epicycle, while the large one
          becomes the path for its center.  And since it is easier to
          visualize the motion when the epicyle is smaller than the
          orbit of its center, they preferred that arrangement.  We
          object that the center of this swapped epicycle has become a
          point in empty space (as opposed to the Sun), but of course
          all the (nearly) circular orbit paths we draw are imaginary
          as well.</p>
        <p>Watching the outer planets wag back and forth around their
          ghostly epicycle centers on the planet clock may help you to
          understand what the ancients saw in epicycles.</p>
      </div>
    </div>
    <div id="mars-year-help" class="helper hidden">
      <h1>Tips &amp; Queries:
        <span>&lt;</span>Mars Period<span>&gt;</span></h1>
      <div class="question">
        What does the plot in the right panel show?</div>
      <div class="answer">
        <p>Before you can begin surveying, you must determine the
          orbital period of the planet you will use as a landmark.
          Mars is by far the best landmark choice, so here you will
          explore how to adapt the technique you used to determine the
          orbital period of Earth to the case of Mars.  The plot in
          the right panel here behaves analogously to the right panel
          in the Earth Period section, with all the same controls.
          Here, when you click the Reset button on the clock, you
          collect twenty years of virtual position data for Mars, with
          observations spaced 10 days apart.  Kepler used twenty
          years of Mars data from Tycho for his survey.</p>
        <p>The Mars data of time (in days) versus longitude (in revs)
          appears as a series of light red S-curves along the diagonal
          of the plot.  The kinks in the S-curves are the retrograde
          parts of Mars's orbit, and gaps between them are the times
          when Mars is too close to the Sun to be able to make any
          observations.  When you move the planet clock in the left
          panel, a faint red dot traces the time-longitude data along
          the plot in the right panel, so you can see which date
          corresponds to each data point.</p>
        <p>Unfortunately, these data record the position of Mars on
          the zodiac from our point of view on Earth.  In order to
          determine the period of Mars in its orbit around the Sun, you
          need to know where Mars appears as viewed from the Sun, so
          you can judge how long it takes to go around exactly once.
          Fortunately, on each S-curve there is exactly one point
          where you <em>do</em> know where Mars appears when viewed
          from the Sun: When Mars is at opposition, we on Earth are
          seeing it at exactly the same ecliptic longitude as it would
          have as viewed from the Sun.  These opposition points are
          marked in dark red on the plot.  Of all the data you
          collected over that twenty year span, only these nine or ten
          opposition points are of any use for making an accurate
          estimate of the period of Mars.</p>
        <p>The yellow boxes along the diagonal again have a width of
          exactly one revolution, and a height of one estimated Mars
          period, which you can adjust using the slider on the right
          edge.  The yellow line again has the slope of the diagonal,
          but instead of actually being the diagonal, it is shifted to
          pass through the first opposition point.  You want to adjust
          the slope of this yeloow line - the period of Mars - to pass
          through all the oppostion points as nearly as possible.</p>
        <p>When you zoom in, the first step once again copies and
          shifts all the year boxes to stack them on top of the first
          box at the lower left.  Since only the opposition points are
          of interest, they are connected by an arbitrary smooth curve
          (a natural cubic spline here, but other choices work just as
          well).  Although in reality each of these points is
          separated by over a full period from the previous one, we
          are assuming that there really is a continuous orbital path
          of time versus ecliptic longitude <em> as view from the
          Sun</em> - something like the dark red curve - which passes
          though each of the oppostion points.  You now see why twenty
          years of data was not an arbitrary choice: In twenty years
          oppositions progress around the zodiac just slightly more
          than once.  This gives you a small overlap section in the
          red curve connecting them.  By adjusting the estimated Mars
          period until the overlapping sections match as well as
          possible, you can get a pretty accurate estimate of Mars's
          period, within perhaps half a day or a bit better.</p>
        <p>Notice that, unlike the case for Earth's orbit, the red
          curve that constitutes you best guess at how Mars moves
          around the Sun differs quite markedly from the straight
          yellow line.  Mars speeds up and slows down as it moves
          around the Sun far more than Earth.  This exaggerated
          variation from uniform motion is another reason why Mars is
          the best landmark choice.  When you zoom in a second time,
          the plot again switches to show you the difference between
          the red curve and yellow line on the vertical axis.  You can
          make your final adjustment here to find the period of Mars
          to within a few hundredths of a day.</p>
        <p>Unlike for the Earth, the overlap sections at this zoom
          level usually will not match very well.  This is not because
          the orbit of Mars is less periodic than Earth.  It is
          because your data is much sparser - you have only nine or
          ten points on Mars's orbit, while you had 75 on Earth's.
          Remember that the red curve has an arbitrary shape - it
          could be any smooth curve passing through the red opposition
          points.  The actual time-longitude curve would match
          perfectly.</p>
        <p>Because of this, your estimate of Mars's period will be
          less accurate than your estimate of Earth's period.  Once
          you begin surveying, you will be able to tighten up this
          estimate.  For now it is easily good enough to begin
          surveying.</p>
      </div>
      <div class="question">How do the controls work?</div>
      <div class="answer">
        <ol>
          <li>Use planet clock controls to set starting date.</li>
          <li>Click Reset button (in planet clock dial) to collect twenty
             years of Sun position data.</li>
          <li>Click lower triangle (in upper left corner) to zoom in plot.</li>
          <li>Click upper triangle (in upper left corner) to zoom out plot.</li>
          <li>Drag slider (along right edge) up or down to change your
            estimate of Mars's orbital period.</li>
        </ol>
      </div>
      <hr/>
      <div class="answer"></div>  <!-- do not remove dummy answer -->
      <div class="question">How could you find the periods
         of the other planets?</div>
      <div class="answer">
        <p>Each planet has its own set of challenges.  With twenty
          years of data, you can use this same opposition technique to
          make a pretty accurate estimate of the period of Jupiter.
          To use it for Saturn, you would need over thirty years of
          data.</p>
        <p>Since they are never at opposition, you can never be sure
          of the direction of Mercury or Venus when viewed from the
          Sun.  Your best alternative is probably to estimate the time
          of inferior conjunction - the retrograde conjunction - as
          best you can.  The planet is not visible for the shortest
          period of time near that conjunction, so your interpolated
          time of conjunction will be more accurate than for superior
          conjunction.  To partly compensate for the inaccuracy of the
          time of inferior conjunction compared to opposition, twenty
          (Earth) years of data gives you many more revolutions of
          Mercury or Venus than you had of Mars.</p>
        <p>In practice, however, the best approach is to use the
          orbits of Mars and Earth you will generate in your upcoming
          survey to derive Kepler's first two laws.  These laws reduce
          all orbits to just a few parameters.  You can then use the
          position data you actually have (as opposed to interpolated
          inferior conjunctions) to find the parameter values which
          best fit your observations.</p>
      </div>
    </div>
    <div id="surveyor-help" class="helper hidden">
      <h1>Tips &amp; Queries:
        <span>&lt;</span>Survey Orbits<span>&gt;</span></h1>
      <div class="question">
        What does the diagram in the right panel show?</div>
      <div class="answer">
        <p>The diagram is the same map of points in the ecliptic plane
          as in the Orbit View section.  There, the points on the
          orbits were provided for you by magic.  Here, you will
          actually do the work to survey a large set of points on the
          orbits of the Earth and Mars.  This work is divided into
          three steps:</p>
        <ol>
          <li>Select one of the nine or ten oppositions you found in
            the Mars Period section to serve as a reference point on
            Mars's orbit.</li>
          <li>Starting from this reference observation, you will step
            forward or backward by multiples of your estimated Mars
            period.  This allows you to survey the positions of
            several points on Earth's orbit.</li>
          <li>Starting from each of these different points on
            Earth's orbit, you will step forward or backward by
            multiples of Earth's period.  This allows you to survey
            several points on Mars's orbit.</li>
        </ol>
        <p>Move forward through these steps by clicking the Next
          button, back by clicking the Prev button.  Unlike the period
          determination, this procedure eventually makes full use of
          all of your twenty years of Mars observations, not just nine
          or ten opposition points.</p>
        <p>When you select an oppostion in step 1, the radial line
          from the Sun to Mars at that opposition is highlighted in
          black.  (It is really from the Sun to the projection of Mars
          into the ecliptic plane.)  You know the direction - that is,
          ecliptic longitude - of this line segment, but you do not
          know its length.  However, you do not know <em>any</em>
          distances in the ecliptic plane.  Therefore, you are free to
          use this black segment as a reference ruler you will use to
          measure distances in the solar system.  The actual
          dimensions of the solar system in kilometers were unknown
          until long after Kepler.</p>
        <p>In step 2, you use this reference segment to survey eight
          or nine points on Earth's orbit.  These are drawn with
          yellow Earth-Sun lines and red Earth-Mars lines.  As you
          click the ±M buttons to step your observation time forward
          or back one Mars year at a time, the planet clock will
          automatically move to the time of that observation, and the
          yellow and red lines will be highlighted on the right panel.
          The point on Earth's orbit has been placed where it must be
          to make the highlighted yellow and blue lines on the right
          panel exactly match the directions of the yellow and red
          lines on the planet clock.  This is precisely how surveyors
          triangulate two known landmarks - the Sun and your reference
          opposition point on Mars's orbit in this case - to chart
          their own position.</p>
        <p>Notice that one or two points are missing on this ring of
          points on Earth's orbit.  These points are too close to
          conjunction to be able to see Mars.  You will find their
          positions later when you have other points on Mars's
          orbit.</p>
        <p>When you advance to step 3, you will be able to step not
          only by Mars periods, but also by Earth periods.  The
          diagram simultaneously steps all of the observations you
          made of Mars at the reference point forward or backward by
          one Earth year.  Since Mars always moves to the same place
          after any fixed time step, you will be looking at Mars when
          it is at a single new place from eight or nine different
          viewpoints.  If your hypothesis that Mars is moving
          periodically relative to the Sun is correct, all eight or
          nine of the sight lines on these dates should converge at a
          single point - that new point on Mars's orbit.  Click the ±E
          button and see what happens.</p>
        <p>Aha!  Look at that!  Step back and forth with the ±M
          buttons to move the planet clock to over a half dozen
          different observation dates and check that all those red
          Mars sight lines really do converge at a single point.  It
          almost feels like magic.  If you drag the slider on the
          right edge away from the true Mars period, you can see that
          the lines no longer converge properly - you need to be able
          to step exactly one Mars period to get fixed surveying
          landmarks and make the scheme work.</p>
        <p>As you step forward and back Earth years, notice that you
          slowly lose points on Earth's orbit because they will fall
          outside your twenty year data window.  You also occasionally
          gain a new point as it moves into your twenty year window.
          Completely new points on Earth's orbit are marked by a faint
          yellow Earth-Sun line in addition to the red Earth-Mars
          line.  These new points are located by triangulation using
          the point where all the sight lines from existing points on
          Earth's orbit converge.  Hence as you add new points on
          Mars's orbit you also pick up new points on Earth's
          orbit.</p>
        <p>Since the periods of Earth and Mars are incommensurate, you
          could continue this process indefinitely.  Of course, the
          more periods you step away from your reference opposition
          date, the more the error due to any inaccuracy in your Mars
          or Earth period grows.  Since the uncertainty in your Mars
          period is greater, this calculator limits you to ten Mars
          period steps away from your reference opposition in either
          direction.  This arbitrary limit always produces 21 points
          around Earth's orbit and about 40 points around Mars's
          orbit.  Because you have collected observations of several
          different points on Mars's orbit from each point on Earth's
          orbit, and you have viewed each point on Mars's orbit from
          several different points on Earth's orbit, you have used
          observations made on a total of about 350 dates in order to
          survey these 60 odd orbital points.  The diagram plots all
          the surveyed points on both orbits as faint dots.</p>
      </div>
      <div class="question">What do the numbers in the upper
        right corner in the third step mean?</div>
      <div class="answer">
        <p>When you observe a new point on Mars's orbit from several
          different points on Earth's orbit (spaced in time by
          multiples of Mars's period), you add in to your chart of
          points by plotting the common intersection of the direction
          of Mars you observed at each of those times, starting from
          the position of the Earth points you previously got by
          triangulating a previous point on Mars's orbit.  However,
          those lines will never exactly intersect at a common point;
          in fact, if you use the actual direction in 3D - latitude as
          well as longitude - none of the lines will exactly intersect
          any other at all.  The lines will always be skew.  But if the
          common point of intersection is only approximate, how do you
          compute exactly where to plot it on your chart of Mars's
          orbit?</p>
        <p>The modern approach to this kind of problem is called least
          squares fitting.  A least squares fit is a computationally
          convenient way to define the best compromise point: The
          lines may not all intersect at any point, but there will
          always be a point which lies at the minimum RMS (root mean
          square) distance from all the lines.  However, in this case,
          you are measuring a direction - angles of longitude and
          latitude - so you really ought to find the point that
          minimizes the RMS angle by which the line from Earth to this
          point deviates from your measured direction.  The calculator
          that generates this diagram does just that: Each new point
          on Mars's orbit is placed at the position that minimizes the
          RMS angular deviation from all of your measurements of Mars
          at that point (from previously charted points on Earth's
          orbit).</p>
        <p>Notice that since both latitude and longitude measurements
          are used, this gives a position of Mars in 3D, even though
          this diagram only shows the projection of that point into
          the plane of the ecliptic.  The full 3D position will be
          shown in the Mars Inclination section.</p>
        <p>The numbers above your current estimated Mars period are
          two measures of the total angular deviations of all 40 of
          these fitted points on Mars's orbit, using all 350 direction
          measurements: The bottom number is the RMS angular deviation
          of all of your measured directions from the direction of the
          charted Mars point from the charted Earth point.  The top
          number is the largest angular deviation of any of the 350
          observations from its corresponding Mars position on the
          chart.  Using these numbers, you can make a final adjustment
          to your estimated period of Mars: Move the slider until you
          minimize one or the other of these two numbers - they will
          both minimize for nearly the same period.</p>
        <p>After this final period adjustment, you can usually drive
          the maximum angular error down to about 0.02° and the RMS
          angular error to about 0.01°.  Tycho, the last and greatest
          naked-eye astronomer in history, measured the positions of
          planets with an accuracy of about 0.03° - about 1/15 the
          disk of the Sun or Moon, and Kepler used his data.  (Someone
          with acute vision cannot distinguish two marks separated by
          less than about half that, or half a millimeter viewed at a
          distance of a meter.)  Notice that the groups of lines
          converging on every point around Mars orbit converge most
          accurately for a single value of the period of Mars.</p>
        <p>(Any error in the period of Earth would lead to a similar
          failure of your survey lines to converge.  For simplicity,
          this calculator uses the exact value of 365.25636 days
          rather than the value you found in the Earth Period section.
          As noted, it is much easier to determine the period of Earth
          than the period of any other planet.)</p>
      </div>
      <div class="question">How do the controls work?</div>
      <div class="answer">
        <ol>
          <li>Click on opposition to select reference opposition.</li>
          <li>Click Next button at upper right to move to the next step.</li>
          <li>Click ±M buttons at lower right to step Mars periods.</li>
          <li>Click ±E buttons at lower left to step Earth periods.</li>
          <li>Click Prev button at upper left to return to the
            previous step.</li>
          <li>Drag slider (along right edge) up or down to change your
            estimate of Mars's orbital period.</li>
        </ol>
      </div>
      <hr/>
      <div class="answer"></div>  <!-- do not remove dummy answer -->
      <div class="question">How confident are you in the
        orbital points you just surveyed?</div>
      <div class="answer">
        <p>You have discovered a very well hidden regularity in twenty
          years of painstakingly measured postions of the Sun and
          Mars.  The greatest geniuses of astronomy pored over data
          very similar to this for two millenia without finding these
          relationships among the positions.  The striking geometrical
          relationships are buried two levels deep - you first need to
          find a set of points on Earth's orbit by stepping by Mars
          years from an opposition, and then find a new point on
          Mars's orbit by stepping by an Earth year, then finally you
          get to see the incredible accuracy with which these several
          sight lines converge at a single point.</p>
        <p>On the other hand, these steps are routine for terrestrial
          surveyors.  But the trick that you need to wait a certain
          fixed period of time for your landmarks or viewpoints to
          return to their positions has no real analog in ordinary
          surveying.  Kepler is the one who first figured out how to
          put the two ideas together.</p>
        <p>You cannot doubt that your survey points represent an
          accurate map of the positions of the Sun, Mars, and Earth,
          any more than you can doubt a terrestrial map made by
          surveyors.  Of course, in order to make this map, you had to
          assume that the planets periodically return to the same
          positions, each after its own fixed period.  You then
          adjusted those periods precisely in order to make your
          surveying techiniques self-consistent.  Is this not circular
          reasoning?  Yes, but by adjusting only one number (two if
          you count the period of Earth), you were able to exactly fit
          over 350 independent observations of the directions of the
          Sun and Mars.  It is very hard to doubt that the hypothesis
          of periodic orbits is correct, in addition to the geometry
          of your survey points.</p>
        <p>Furthermore, you can repeat this survey for any twenty year
          data set you please throughout the ages, or more easily
          using a different opposition in the same twenty year window
          for the starting reference point.  The specific points you
          get around the orbits will be different, but the convergence
          of the sight lines on all the different days will be just as
          accurate.</p>
      </div>
      <div class="question">Have you proven Earth and
        Mars repeat closed orbits around the Sun?</div>
      <div class="answer">
        <p>You have proven that Earth and Mars move <em>as if</em>
          they followed repeating closed orbits around the Sun.  Of
          course, we now routinely measure the tiny discrepancies in
          the orbits of the planets from this rule.  Though the rule
          may not be exact, nevertheless it is very, very
          accurate.</p>

        <div style="min-width: 300px; max-width: 500px;
                    padding: 10px; margin: 0 auto;">
          <img src="epicycle.svg" style="width: 100%"
               alt="picture of orbit scaling" />
        </div>

        <p>The ancient Greeks noticed that you can rescale the center
          point and orbit of any planet, keeping the Earth fixed at
          the center of this scaling operation, without changing any
          directions as observed from Earth.  It is impossible to
          disprove such a model by observations of the directions to
          the planets, since by construction those directions remain
          fixed.  But how likely does it seem that a planet orbits a
          point in empty space which moves around Earth to stay
          exactly on the Earth-Sun line?  Apparently, to ancient Greek
          philosopy, this seemed more likely than that it simply
          orbits the Sun.  The question was not definitively settled
          until Galileo observed the phases of Venus through his
          telescope, proving that its prograde conjunctions are behind
          the Sun and its retrograde conjunctions in front of the Sun.
          By naked eye, there is no way to tell.</p>
        <p>This strange orbit scaling idea may have been the genesis
          of the other peculiar choice of Ptolemy's epicycles picture
          for the outer planets: The reversal of the epicycle and
          deferent that makes the planet move around a center that is
          in empty space.  If the orbit scaling idea came first, then
          it, too, places the center of the epicycle at a point in
          empty space.  The orbit scaling hypothesis was undoubtedly
          invented to keep each planet within its own (imaginary)
          sphere above the Earth.  But if the epicycle radius is
          larger than the deferent radius (as we draw the orbits of
          the outer planets), scaling them cannot isolate all these
          imaginary orbit lines in their own sphere!  If that is why
          you are scaling the orbits, then you <em>must</em> swap
          epicycle and deferent for the scaling to have the effect you
          want.  The single idea that each planet together with all
          the imaginary lines and orbit paths used to describe it must
          fit within its own sphere above the Earth seems to have
          driven the only real error of the Ptolemaic system - its
          arbitrary scaling of the orbits.</p>
        <p>Would the astonishing consistency of Kepler's surveying
          technique have convinced ancient Greek astronomers that the
          planets orbited the Sun rather than moving along scaled
          orbits whose centers merely aligned with the direction of
          the Sun?  They may well have acknowledged only the
          periodicity of the motion and clung to their scaled orbits.
          At the same time, they would certainly have pounced on
          Kepler's surveyed orbital shapes and recognized them as the
          true shapes of their deferents and epicycles.</p>
      </div>
      <div class="question">Do you think the other
        planets repeat closed orbits around the Sun?</div>
      <div class="answer">
        <p>Your first order of business is to check that the other
          planets do indeed repeat closed orbits.  Are you the kind of
          person who hopes that the answer is yes?  Or no?  Is your
          work done if the answer is yes?</p>
      </div>
    </div>
    <div id="incline-help" class="helper hidden">
      <h1>Tips &amp; Queries:
        <span>&lt;</span>Mars Inclination<span>&gt;</span></h1>
      <div class="question">
        What does the diagram in the right panel show?</div>
      <div class="answer">
        <p>Initially, the right panel shows the same chart of the
          orbits of Mars and Earth as the third step of the Survey
          Orbits section.  However, the points you charted on Mars's
          orbit are now plotted in 3D, as you can see by dragging the
          sliders on the bottom and right edges.  You can see that
          your surveyed points all lie in a single plane containing
          the Sun, but tilted at a small angle away from the ecliptic.
          Because this orbital inclination of Mars is so small, you
          should magnify the z-coordinates by clicking the 10× button
          so you can clearly see the tilt.  You should click on the
          point on Mars's orbit where the red sight lines converge to
          turn them off as you familiarize yourself with this
          diagram.</p>
        <p>The light blue line through the Sun is the intersection of
          the best fit plane to your Mars survey points with the
          ecliptic plane, which is called the line of nodes.  The
          ecliptic longitude of this line of nodes (specifically the
          ascending node) is the number at the top right of the
          diagram.  The angle between this best fit plane and the
          ecliptic plane, the orbital inclination of Mars, is the
          number under the ascending node longitude.  Click the Reset
          button at the lower left to return to the map of the
          ecliptic plane.  Now drag the bottom slider until the blue
          node line is vertical (you can use the stationary tick mark
          at the top of the diagram to align it exactly).  Drag the
          right slider all the way to the top to get the view along
          the line of nodes, exactly edge on to both the ecliptic and
          the plane of Mars's orbit.  If you go back to 1×
          z-magnification you can see how small the tilt really
          is.</p>
        <p>Notice that a ring of faint red dots is drawn in the
          ecliptic plane.  These are the projections of your dark red
          surveyed points into the ecliptic plane.  Viewed from Earth,
          these points have the same ecliptic longitude as Mars, but
          zero ecliptic latitude.</p>
        <p>You can click on any of the dark red points to toggle on or
          off red sight lines for all of the observations you made of
          Mars when it was at that position through your twenty years
          of data.  The corresponding blue points on Earth's orbit
          will highlight.  When you view any set of these sight lines
          from different perspectives using the sliders, you can see
          that they all converge to a single point in 3D, not just in
          the plane of the ecliptic.</p>
      </div>
      <div class="question">How do the controls work?</div>
      <div class="answer">
        <ol>
          <li>Drag bottom slider to rotate ecliptic plane around Sun.</li>
          <li>Drag right edge slider to rotate view out of ecliptic plane.</li>
          <li>Click one of the magnify z buttons at upper left to select z
            magnification.</li>
          <li>Click any red point on Mars orbit to toggle on or off
            sight lines from Earth orbit points.</li>
          <li>Click Reset button at lower left to restore original
            orientation.</li>
        </ol>
      </div>
      <hr/>
      <div class="answer"></div>  <!-- do not remove dummy answer -->
      <div class="question">What features are most remarkable about
        your survey points?</div>
      <div class="answer">
        <p>The fact that all the Earth-Mars sight lines emanating from
          your surveyed positions of Earth at the dates you found by
          stepping multiples of Mars years all converge at a single
          point in three dimensions is very striking.  Kepler's survey
          technique works in three dimensions, as it must to be
          successful.</p>
        <p>As if all these convergences were not remarkable enough,
          you should also reflect on the fact that the survey points
          all lie exactly in a single plane containing the Sun.  You
          did not assume this - the only thing you assumed to make
          your survey was that the orbits of Earth and Mars were
          periodic.  You already knew that Earth's orbit was confined
          to a plane containig the Sun, because that it how you
          defined the plane of the ecliptic.  But you now know that
          not only is Mars's orbit as periodic as Earth's, but that it
          too is confined to a plane containing the Sun.</p>
        <p>It seems as if Mars, and probably the other planets,
          completely ignore one another - only the Sun seems to exert
          any influence over the motion of the planets.  Heliocentrism
          is not about what body lies at the the center so much as
          what body dominates the dynamics.  The answer is apparently
          that every body except the Sun is negligible.</p>
      </div>
    </div>
    <div id="first-two-r-help" class="helper hidden">
      <h1>Tips &amp; Queries:
        <span>&lt;</span>First Two Laws<span>&gt;</span></h1>
      <div class="question">
        What does the diagram in the left panel show?</div>
      <div class="answer">
      </div>
      <div class="question">
        What does the plot in the right panel show?</div>
      <div class="answer">
      </div>
      <div class="question">How do the controls work?</div>
      <div class="answer">
      </div>
      <hr/>
      <div class="answer"></div>  <!-- do not remove dummy answer -->
    </div>
    <div id="third-law-r-help" class="helper hidden">
      <h1>Tips &amp; Queries:
        <span>&lt;</span>Third Law</h1>
      <div class="question">
        What does the diagram in the left panel show?</div>
      <div class="answer">
      </div>
      <div class="question">
        What does the plot in the right panel show?</div>
      <div class="answer">
      </div>
      <div class="question">How do the controls work?</div>
      <div class="answer">
      </div>
      <hr/>
      <div class="answer"></div>  <!-- do not remove dummy answer -->
    </div>
  </div>

<!-- Load d3 library.  Later should grab only pieces used.
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.4.4/d3.min.js"></script>
-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.4.4/d3.js"></script>
<script src="./ephemeris.js"></script>
<script src="./planetclock.js"></script>
<script>

  const clock = new PlanetClock(d3.select("#top-clock"));
  clock.goToDay(dayOfDate(new Date()));
  clock.hasMoonButton(true);
  clock.disabled = true;
  let introCover = clock.svg.append("foreignObject")
      .attr("xmlns", "http://www.w3.org/1999/xhtml")
      .attr("width", 620).attr("height", 580)
      .attr("x", -310).attr("y", -290);
  introCover.append(() => d3.select("#intro").node());
  const eyear = new EarthYear(d3.select("#earth-year"), clock);
  const orbits = new OrbitView(d3.select("#orbit-view"), clock);
  const myear = new MarsYear(d3.select("#mars-year"), clock);
  const surveyor = new SurveyOrbits(d3.select("#surveyor"), clock, myear, eyear);
  const incline = new Inclination(d3.select("#incline"), clock, surveyor);
  const laws2 = new TwoLaws(d3.select("#first-two-l"),
                            d3.select("#first-two-r"), incline);
  const law3 = new ThirdLaw(d3.select("#third-law-l"),
                            d3.select("#third-law-r"), incline);
  const slaves = {"top-clock": null, "earth-year": eyear, "orbit-view": orbits,
                  "mars-year": myear, "surveyor": surveyor, "incline": incline,
                  "first-two-r": laws2, "third-law-r": law3};

  const hamburger = document.querySelector("#main-hamburger");
  const sidebar = document.querySelector("#main-sidebar");
  const overlay = document.querySelector("#main-overlay");
  function openSidebar() {
    const hamList = hamburger.classList;
    const barList = sidebar.classList;
    if (hamList.contains("holding")) {
      // Usage Overlay active - take overlay down but keep sidebar collapsed.
      hamList.remove("holding", "open");
      const overList = overlay.classList;
      overList.add("faded");
      d3.timeout(() => { overList.add("hidden"); resetHelper(); }, 500);
    } else {
      hamList.toggle("open");
      barList.toggle("open");
    }
  }

  let activeAnswer;
  function toggleAnswer() {
    const answer = this.nextElementSibling;
    console.log(this, answer);
    if (activeAnswer) activeAnswer.classList.remove("active");
    if (answer == activeAnswer) {
      activeAnswer = undefined;
    } else {
      answer.classList.add("active");
      activeAnswer = answer;
    }
  }
  document.querySelectorAll(".question").forEach(
    e => { e.onclick = toggleAnswer; });

  const helpers = Object.keys(slaves).map(s => "#" + s + "-help");
  let helperDiv = helpers[0];
  function pageTips(di) {
    for (let i=0 ; i<helpers.length ; i+=1) {
      let helpList = document.querySelector(helpers[i]).classList
      if (!helpList.contains("hidden")) {
        helpList.add("hidden");
        helperDiv = helpers[i+di];
        document.querySelector(helperDiv).classList.remove("hidden");
        break;
      }
    }
  }
  function prevTips() {
    return pageTips(-1);
  }
  function nextTips() {
    return pageTips(1);
  }
  document.querySelectorAll(".helper h1 span").forEach(
    e => {
      e.onclick = (e.innerText == "<")? prevTips : nextTips;
    });
  function resetHelper() {
    if (currentSlave == null) {
      helperDiv = helpers[0];
      document.querySelector(helperDiv).classList.remove("hidden");
    } else {
      document.querySelector(helpers[0]).classList.add("hidden");
    }
    for (let i=1 ; i<helpers.length ; i+=1) {
      const panel = document.querySelector(helpers[i].slice(0, -5));
      if (panel.classList.contains("hidden")) {
        document.querySelector(helpers[i]).classList.add("hidden");
      } else {
        helperDiv = helpers[i];
        document.querySelector(helperDiv).classList.remove("hidden");
      }
    }
  }
  function showHelperScroll(on) {
    document.querySelectorAll(".helper h1 span").forEach(
      e => {
        if (on) {
          e.classList.remove("hidden");
        } else {
          e.classList.add("hidden");
        }
      });
  }

  function removeIntro() {
    const intro = d3.select("#intro");
    intro.style("transform", "translate(750px, -375px) scale(0.1)");
    hamburger.classList.remove("hidden");
    d3.timeout(
      () => {
        introCover.style("display", "none");
        clock.disabled = false;
      }, 310);
  }

  function restoreIntro() {
    hamburger.classList.add("hidden");
    const intro = d3.select("#intro");
    introCover.style("display", null);
    d3.timeout(() => intro.style("transform", "translate(0, 0)"), 10);
    d3.timeout(
      () => {
        clock.disabled = true;
      }, 310);
  }

  let currentElem = document.querySelector(".sidebar ul li.current");
  const clockElem = currentElem;
  let currentSlave = null;

  function makeCurrent(elem) {
    if (elem == currentElem) return true;
    hamburger.classList.remove("open");
    sidebar.classList.remove("open");
    if (currentElem) currentElem.classList.remove("current");
    elem.classList.add("current");
    ["mercury", "venus", "jupiter", "saturn"].forEach(
      p => clock.setHandVisibility(p, false));
    const oldDiv = currentElem.dataset.id;
    const newDiv = elem.dataset.id;
    document.querySelector(helperDiv).classList.add("hidden");
    document.querySelector("#"+oldDiv+"-help").classList.add("hidden");
    document.querySelector("#"+newDiv+"-help").classList.remove("hidden");
    const oldDivL = oldDiv.endsWith("-r")? oldDiv.replace("-r", "-l")
          : "top-clock";
    if (oldDiv != "top-clock") {
      const classes = document.querySelector("#"+oldDiv).classList;
      classes.add("shrunken");
      d3.timeout(() => classes.add("hidden"), 300);
      clock.setHandVisibility("mars", true);
    }
    if (currentSlave != null) {
      currentSlave.activate(false);
    }
    currentSlave = slaves[newDiv];
    const newDivL = newDiv.endsWith("-r")? newDiv.replace("-r", "-l")
          : "top-clock";
    if (newDiv != "top-clock") {
      clock.hasMoonButton(false);
      clock.setHandVisibility("mars", true);
      currentSlave.activate(true);
      const classes = document.querySelector("#"+newDiv).classList;
      classes.remove("hidden");
      d3.timeout(() => classes.remove("shrunken"), 10);
    } else {
      clock.removeElapsed();
      clock.hasMoonButton(true);
    }
    if (newDivL != oldDivL) {
      const oldList = document.querySelector("#"+oldDivL).classList;
      const newList = document.querySelector("#"+newDivL).classList;
      oldList.add("faded");  // triggers 0.3s transition
      d3.timeout(() => {  // wait for fade, then fade new div in
        oldList.add("hidden");
        newList.remove("hidden", "faded");
      }, 300);
    }
    currentElem = elem;
    return false;
  }

  function usageClick(elem) {
    hamburger.classList.add("holding");
    sidebar.classList.remove("open");
    overlay.classList.remove("hidden");
    d3.timeout(() => overlay.classList.remove("faded"), 10);
  }

  function clockClick(elem) {
    if (makeCurrent(elem)) {
      hamburger.classList.remove("open");
      sidebar.classList.remove("open");
      restoreIntro();
      return;
    }
  }

  function earthClick(elem) {
    if (makeCurrent(elem)) return;
  }

  function orbitClick(elem) {
    if (makeCurrent(elem)) return;
  }

  function marsClick(elem) {
    if (makeCurrent(elem)) return;
  }

  function surveyClick(elem) {
    if (makeCurrent(elem)) return;
  }

  function inclineClick(elem) {
    if (makeCurrent(elem)) return;
  }

  function twoClick(elem) {
    if (makeCurrent(elem)) return;
  }

  function thirdClick(elem) {
    if (makeCurrent(elem)) return;
  }

  // Interpret URL query parameters
  // helpDebug=yes     (helper scroll buttons)
  // tab=orb-view  (intro, earth-year, orb-view, ... main select id)
  // day=8114      (clock.elapsed0 JD minus J2000 day number)
  // eyear=365.25636  (earthYear period value, otherwise unused)
  // myear=686.979  (marsYear.yearEstimate value)
  // oppo=0        (surveyor.iOppo opposition index)
  let urlQueries = location.search.replace("\?", "");
  if (urlQueries) {
    urlQueries = Object.fromEntries(urlQueries.split("&")
                                    .map(q => q.split("=")));
  } else {
    urlQueries = {}
  }
  showHelperScroll(urlQueries.helpDebug == "yes");
  if (urlQueries.eyear && !isNaN(urlQueries.eyear)) {
    let year = parseFloat(urlQueries.eyear);
    if (year < 350) year = 350;
    else if (year > 380) year = 380;
    earthYear.changeYearEstimate(year);
  }
  if (urlQueries.day && !isNaN(urlQueries.day)) {
    let day = parseFloat(urlQueries.day);
    clock.goToDay(day);
    clock.elapsed0 = day;
    eyear.elapsedUpdate(true);
    myear.elapsedUpdate(true);
    if (urlQueries.myear && !isNaN(urlQueries.myear)) {
      let year = parseFloat(urlQueries.myear);
      if (year < 650) year = 650;
      else if (year > 730) year = 730;
      myear.changeYearEstimate(year);
    } else {
      myear.changeYearEstimate(686.97973);
    }
    if (!urlQueries.eyear) {
      eyear.changeYearEstimate(365.25636);
    }
    surveyor.notReady();
    if (urlQueries.oppo && !isNaN(urlQueries.oppo)
        && surveyor.oppositionsFound) {
      let iOppo = parseInt(urlQueries.oppo);
      if (iOppo >= 0 && iOppo < surveyor.oppositionsFound.length) {
        surveyor.selector(undefined, [undefined, iOppo]);
      }
    } else {
      surveyor.selector(undefined, [undefined, 0]);
    }
    surveyor.findEarth();
    surveyor.findMars();
  }
  if (urlQueries.tab &&
      ["intro", "orb-view", "earth-year", "mars-year", "survey-orbits",
       "mars-incline", "two-laws", "third-law"].indexOf(urlQueries.tab)) {
    if (urlQueries.tab != "intro" || urlQueries.helpDebug == "yes")
      removeIntro();
    document.querySelectorAll("#main-sidebar ul li").forEach(
      e => {
        if (e.dataset && e.dataset.id == urlQueries.tab) e.click();
      });
  }
  if (urlQueries.helpDebug && urlQueries.helpDebug == "yes") {
    openSidebar();
    document.querySelector("#main-sidebar ul li.usage").click();
  }

</script>


</body>
</html>
