<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Surveying the Solar System</title>
  <meta name="description"
    content="How to survey the solar system using only naked-eye observations.">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script>MathJax = {tex: { inlineMath: [["$", "$"], ["\\(", "\\)"]] }};
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"
          id="MathJax-script">
  </script>
  <style>
    /* @import url('https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;0,900;1,300;1,400;1,700;1,900&family=Roboto:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap'); */
    @import url('https://fonts.googleapis.com/css2?family=Merriweather+Sans:ital,wght@0,400;0,700;1,400;1,700&family=Merriweather:ital,wght@0,400;0,700;1,400;1,700&display=swap');

    body {
        margin: 0;
        padding: 0;
        font-family: 'Merriweather', serif;
        /* font-family: 'Merriweather Sans', sans-serif; */
    }

    .unselectable {
        -webkit-user-select: none; /* Safari */
        -ms-user-select: none; /* IE 10 and IE 11 */
        user-select: none; /* Standard syntax */
    }

    #intro {
        width: 100%;
        height: 100%;
        padding: 7%;
        margin: 0;
        transform: translate(0, 0);
        box-sizing: border-box;
        background: #eeec;
        transition: transform 0.3s;
    }
    #intro ul {
        list-style-type: none;
        font-family: 'Merriweather', serif;
        font-weight: normal;
        font-size: 23px;
        height: 95%;
        padding: 10px;
        margin: 0;
        border: 4px solid darkslategray;
        border-radius: 1em;
        background: #fffb;
    }
    #intro ul li {
        padding: 1ex 0ex;
    }

    #intro .close-x {
        position: absolute;
        top: 10px;
        right: 6px;
    }
    .close-x {
        position: relative;
        width: 40px;
        height: 30px;
        cursor: pointer;
    }
    .close-x::before, .close-x::after {
        content: " ";
        display: block;
        position: absolute;
        left: 0;
        top: 12px;
        height: 6px;
        width: 100%;
        border-radius: 6px;
        background-color: darkslategray;
    }
    .close-x::before {
        transform: rotate(45deg);
    }
    .close-x::after {
        transform: rotate(-45deg);
    }

    .hidden {
        display: none;
    }
    #main-hamburger {
        position: absolute;
        top: 10px;
        right: 10px;
        z-index: 99;
        background: white;
    }
    #main-hamburger:not(.holding).open {
        background: navajowhite;
    }
    .hamburger-x {
        width: 40px;
        height: 30px;
        position: relative;
        transform: rotate(0deg);
        transition: transform .5s ease-in-out, background .5s ease-in-out;
        cursor: pointer;
    }
    .hamburger-x span {
        display: block;
        position: absolute;
        height: 6px;
        width: 100%;
        background: darkslategray;
        border-radius: 6px;
        left: 0;
        transform: rotate(0deg);
        transition: .25s ease-in-out;
    }
    .hamburger-x span:nth-child(1) {
        top: 0px;
    }
    .hamburger-x span:nth-child(2), .hamburger-x span:nth-child(3) {
        top: 12px;
    }
    .hamburger-x span:nth-child(4) {
        top: 24px;
    }
    .hamburger-x.open span:nth-child(1) {
        top: 12px;
        width: 0%;
        left: 50%;
    }
    .hamburger-x.open span:nth-child(2) {
        transform: rotate(45deg);
    }
    .hamburger-x.open span:nth-child(3) {
        transform: rotate(-45deg);
    }
    .hamburger-x.open span:nth-child(4) {
        top: 12px;
        width: 0%;
        left: 50%;
    }

    #top-div {
        width: 100%;
        display: flex;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    .left-wrapper {
        box-sizing: border-box;
        margin: auto;
        flex: 1 1 100%;
        display: flex;
        overflow: auto;
    }

    .left-panel {
        box-sizing: border-box;
        min-width: 450px;
        max-width: 750px;
        margin: auto;
        position: relative;
        flex: 1 1 0;
        opacity: 1;
        transition: opacity 0.3s;
    }
    .left-panel.faded {
        opacity: 0;
    }

    .right-panel {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        transform: scale(1);
        transition: all 0.3s;
        min-width: 450px;
        max-width: 750px;
        margin: auto;
        position: relative;
        flex: 1 1 0;
    }
    .right-panel.shrunken {
        transform: scale(0);
        min-width: 0px;
        max-width: 0px;
        margin: 0;
    }

    .panel-title {
        box-sizing: border-box;
        text-align: center;
        display: block;
        margin: 0;
        padding: 10px 0 0 0;
        height: 30px;
        font-family: 'Merriweather Sans', sans-serif;
        font-size: 28px;
    }

    .sidebar {
        flex: 1 0 auto;
        box-sizing: border-box;
        background: navajowhite;  /* wheat, moccasin, beige, seashell */
        color: slategray;
        margin: 0 auto;
        padding: 30px 0 0 0;
        font-family: 'Merriweather Sans', sans-serif;
        font-size: 135%;
        white-space: nowrap;
        overflow: hidden;
        width: 0;
        transition: width 0.3s;
    }
    .sidebar.open {
        width: 10em;
        transition: width 0.3s;
    }
    .sidebar ul {
        list-style-type: none;
        padding: 0.25ex 0 0 0;
        margin: 1em;
        border-top: 6px solid darkslategray;
    }
    .sidebar ul li:not(.separator) {
        padding: 0.25ex 0 0.25ex 0;
    }
    .sidebar ul li:not(.current, .separator):hover {
        padding: 0.25ex 0 0.25ex 0;
        background: #fdf8e0;  /* oldlace #fdf5e6 */
        color: black;
        font-style: italic;
        font-weight: bold;
        cursor: pointer;
    }
    .sidebar ul li.current {
        font-style: italic;
        background: #fb0;
        color: black;
    }
    .sidebar ul li.separator {
        width: 100%;
        height: 0.2ex;
        background: darkslategray;
    }
    .sidebar ul li.usage {
        text-align: center;
        font-style: italic;
        background: #fb0;
        color: black;
    }

    #main-overlay {
        box-sizing: border-box;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        background: white;
        opacity: 0.95;
        transition: opacity 0.5s;
    }
    #main-overlay.faded {
        opacity: 0;
        z-index: 20;
    }
    .helper {
        min-width: 400px;
        max-width: 750px;
        margin: 0 auto;
        padding: 0 10px 20px;
        font-size: large;
    }
    .helper h1 {
        font-family: 'Merriweather Sans', sans-serif;
        font-size: 24pt;
        color: darkslategray;
        text-align: center;
    }
    .helper hr {
        margin: 4px 0;
        height: 3px;
        background: darkslategray;
    }
    .question {
        box-sizing: border-box;
        border: 2px solid black;
        border-radius: 8px;
        margin: 4px 0;
        padding: 2px 5px;
        color: black;
        background: #fdf8e0;
        font-family: 'Merriweather Sans', sans-serif;
        cursor: pointer;
    }
    .question:hover {
        background: navajowhite;
        font-style: italic;
        font-weight: bold;
    }
    .answer {
        box-sizing: border-box;
        padding: 0 5px;
        font-family: 'Merriweather', serif;
        overflow: hidden;
        max-height: 0;
    }
    .answer.active {
        max-height: 100%;  /* this does not work quite right */
    }

  </style>
</head>

<body>

  <div id="top-div">
    <div id="main-hamburger" class="hamburger-x hidden"
         onclick="openSidebar()">
      <span></span><span></span><span></span><span></span>
    </div>
    <div class="left-wrapper">
      <div id="top-clock" class="left-panel unselectable">
        <!-- The intro will be moved into the clock svg in javascript below.
             Because this is the landing page for the whole site, we want
             the text to scale with the changing size of the clock svg.
          -->
        <div id="intro">
          <!-- 20pt font optimal for chrome, 18pt for firefox -->
          <ul>
            <li style="padding: 1ex 0ex;">This &ldquo;planet
              clock&rdquo; shows the positions of the Sun and planets
              as they move through the constellations of the Zodiac
              <a href="https://ssd.jpl.nasa.gov/planets/approx_pos.html">for
                any date</a> between 5000 years ago and 1000 years
                from now.</li>
            <li style="padding: 1ex 0ex;">You can watch the Sun and
              planets move through the stars, just as you can by
              looking at the sky with your own eyes.
            </li>
            <li style="padding: 1ex 0ex;">Do you see evidence that the
              planets orbit the Sun and not the Earth?  That Earth is
              the third planet?  Can you figure out the order of the
              planets from the Sun?  How would you test these
              ideas?</li>
          </ul>
          <div class="close-x" onclick="removeIntro()">
          </div>
        </div>
      </div>
      <div id="first-two-l" class="left-panel unselectable faded hidden">
        <div class="panel-title">Fit Ellipse to Orbit</div>
      </div>
      <div id="third-law-l" class="left-panel unselectable faded hidden">
        <div class="panel-title">Fit Other Orbits</div>
      </div>
      <div id="orbit-view" class="right-panel unselectable shrunken hidden">
        <div class="panel-title">Picture Planetary Orbits</div>
      </div>
      <div id="earth-year" class="right-panel unselectable shrunken hidden">
        <div class="panel-title">Find Earth Period</div>
      </div>
      <div id="mars-year" class="right-panel unselectable shrunken hidden">
        <div class="panel-title">Find Mars Period</div>
      </div>
      <div id="surveyor" class="right-panel unselectable shrunken hidden">
        <div class="panel-title">Survey Earth &amp; Mars Orbits</div>
      </div>
      <div id="incline" class="right-panel unselectable shrunken hidden">
        <div class="panel-title">Find Mars Inclination</div>
      </div>
      <div id="first-two-r" class="right-panel unselectable shrunken hidden">
        <div class="panel-title">Area-Time Relation</div>
      </div>
      <div id="third-law-r" class="right-panel unselectable shrunken hidden">
        <div class="panel-title">Period-Distance Relation</div>
      </div>
    </div>
    <div id="main-sidebar" class="sidebar unselectable">
      <ul>
        <!-- https://datacadamia.com/web/dom/event/on_content_attribute
             has information on what can go in the onclick string.
             The "this" argument means the element for onclick,
             the "event" argument is the event.  However, it's a little
             unclear how universal this is, and there is very little
             information about exactly what can go in the onclick string.
          -->
        <li onclick="usageClick(this)" class="usage">Tips &amp; Notes</li>
        <li class="separator"></li>
        <li onclick="clockClick(this)" class="current"
            data-id="top-clock">Planet Clock</li>
        <li onclick="earthClick(this)" data-id="earth-year">Earth Period</li>
        <li onclick="orbitClick(this)" data-id="orbit-view">Orbit View</li>
        <li onclick="marsClick(this)" data-id="mars-year">Mars Period</li>
        <li onclick="surveyClick(this)" data-id="surveyor">Survey Orbits</li>
        <li onclick="inclineClick(this)" data-id="incline">Mars Inclination</li>
        <li onclick="twoClick(this)" data-id="first-two-r">First Two Laws</li>
        <li onclick="thirdClick(this)" data-id="third-law-r">Third Law</li>
      </ul>
    </div>
  </div>
  <div id="main-overlay" class="faded hidden">
    <div id="top-clock-help" class="helper">
      <h1>Tips &amp; Notes: Planet Clock</h1>
      <div class="question unselectable">How does the &ldquo;planet clock&rdquo;
        chart the sky?</div>
      <div class="answer">
        <p>The Sun follows a great circle around
          the <a href="https://en.wikipedia.org/wiki/Celestial_sphere">
          celestial sphere</a> during the course of a year.  The
          constellations of the zodiac lie around this circle, serving
          as convenient markers that you can learn to recognize when
          you look at the night sky.  The plane of this great circle
          (or sometimes the circle itself) is called the ecliptic.</p>
        <p>The black outer ring of the &ldquo;planet clock&rdquo;
          represents a ribbon of sky arond the ecliptic: The gray
          circle at the center of the ring is the ecliptic itself;
          points outside this circle are north of the ecliptic in the
          sky, while points inside the circle are south of the
          ecliptic.  The ribbon extends 9 degrees north and south, and
          gray circles are drawn 5 degrees north and south of the
          ecliptic.</p>

        <div style="min-width: 300px; max-width: 700px; padding: 10px;">
          <img src="planetclock.svg" style="width: 100%"
               alt="picture of ecliptic coordinate system" />
        </div>

        <p>The dashed radial lines show the astronomical boundaries of
          the constellations of the zodiac standardized by the IAU in
          1928.  The constellation names appear between these dashed
          lines, tying the black ring to what you see in the sky.
          (The boundaries drawn here for Scorpio include the
          constellation Ophiuchus, whose 1928 boundary intersects the
          ecliptic even though it is not one of the ancient twelve.)</p>
        <p>The solid radial lines marked every 30 degrees around the
          ecliptic show
          <a href="https://en.wikipedia.org/wiki/Ecliptic_coordinate_system">
            J2000 ecliptic longitude</a>.  The gray circles mentioned
          above are J2000 ecliptic latitude lines (including the
          ecliptic, which is ecliptic latitude 0.).  The J2000
          coordinates are fixed relative to the stars, so the planet
          clock shows how the Sun and planets move relative to the
          fixed stars.  The clock shows how the positions of the Sun
          and planets move through the fixed constellations through the
          years.  The gold clock hand shows the longitude of the Sun,
          that is its position in the zodiac.  A fainter gold hand
          shows the longitude exactly opposite the Sun.  You can toggle
          on additional hands for the planets.</p>
        <p>You can also toggle on the Moon.  However, the motion of
          the Moon only relates very subtly to the motions of the
          Sun and planets, and has nothing to do with the topics
          discussed here.</p>
        <p>You can see everything depicted on the planet clock with
          your own eyes by looking at the night sky.  The partial
          exception is the Sun - you also need a good timepiece to
          work out where the Sun is in the sky because you can never
          see the Sun and stars together in the sky!  The sky blue
          sector interrupting the black ring very roughly indicates
          the part of the sky which is too close to the Sun to see any
          stars or planets located there.  (The exact extent of the
          part of the sky obscured by daylight depends on your
          latitude and the time of year.)  The side of the blue sector
          labeled "evening" are stars setting too soon after sunset to
          be seen; the side labeled "morning" are stars which do not
          rise early enough before sunrise to be seen.</p>
        <p>One final point of interest: If you set the clock forward
          or backward by many centuries (try the year -3000, 5
          millenia ago) you will notice that the gray ring labelling
          the months has rotated.  The months (in our Gregorian
          calendar) are tied to the seasons - for example the spring
          equinox is always close to March 20.  The rotation of the
          month dial is caused by the very slow precession of the
          Earth's spin axis relative to the constellations, the
          precession of the equinoxes.</p>
      </div>
      <div class="question unselectable">How do the controls work?</div>
      <div class="answer">
        <ol>
          <li>Drag Sun around sky ring to set date.</li>
          <li>Click year button to set year (accurate from -3000 to 3000).</li>
          <li>Press and hold triangles below sky ring to animate.</li>
          <li>Click legend symbol or planet name to toggle radial line.</li>
          <li>Click Show/Hide Moon button to toggle Moon.</li>
        </ol>
      </div>
      <hr/>  <!-- following dummy answer fixes spacing after this hr -->
      <div class="answer"></div>
      <div class="question unselectable">Do you see evidence that the
        planets orbit the Sun and not the Earth?</div>
      <div class="answer">
        <p>You can quickly see that the motion of the planets is
          <em>connected to</em> the motion of the Sun: Toggle on a
          planet line by clicking on its name in the legend, then
          press and hold one of the triangle animation buttons on the
          lower right.  Mercury and Venus wag back and forth about the
          Sun, never straying far from it.  Mars, Jupiter, and Saturn
          move around the zodiac in the same direction as the Sun but
          more slowly, so at first you may not see their relationship
          to the Sun.</p>
        <p>If you watch more carefully, however, you notice that Mars,
          Jupiter, and Saturn reverse direction whenever they are near
          opposition to the Sun - the light gold line opposite the Sun
          hand of the planet clock.  Mercury and Venus also reverse
          direction as they pass from the evening to the morning side
          (they are moving the same direction as the Sun as they move
          from the morning side to the evening side).  In all cases,
          the retrograde motion of a planet around the zodiac is
          tied to the position of the Sun.</p>
      </div>
      <div class="question unselectable">Do you see evidence that
        Earth is the third planet?</div>
      <div class="answer">
        <p>For Mercury and Venus, you get a strong impression that you
          have an edge-on view of roughly circular orbits around the
          Sun, and the size of those orbits is less than your distance
          from the Sun.  Note that they spend far less time going from
          evening to morning than from morning to evening, as they
          would if they were moving around the Sun in the same
          direction as the Sun is moving around the zodiac.  The
          evening to morning transit is in front of the Sun, while the
          morning to evening transit is behind the Sun.</p>
        <p>For Mars, Jupiter, and Saturn, you might try thinking about
          how Earth would look if you were on Venus.  The direction to
          Earth from Venus is exactly 180 degrees from the direction
          you see Venus from Earth, so the path Earth follows through
          Venus's sky is exactly the reverse of the path we see Venus
          follow.  However, when Venus passes between Earth and Sun,
          Earth appears at opposition from Venus.  That is why Mars,
          Jupiter, and Saturn move retrograde near oppositon - their
          large orbits take them behind you.</p>
        <p>Since you can see that the orbits of Mercury and Venus are
          smaller than your distance to the Sun, while the orbits of
          Mars, Jupiter, and Saturn are larger, Earth must be third in
          order from the Sun.</p>
      </div>
      <div class="question unselectable">Can you figure out the order
        of the planets from the Sun?</div>
      <div class="answer">
        <p>The farthest Mercury or Venus gets from the Sun is called
          its <em>maximum elongation</em>.  You can see that Mercury
          has a smaller maximum elongation than Venus, so its orbit
          must be smaller.  Earth must come third because when the
          others are at opposition, you are between them and the
          Sun.</p>
        <p>Mercury also moves faster than Venus and Venus moves faster
          than the Sun (that is, Earth).  Mars moves around the sky
          slower than the Sun (Earth), Jupiter slower still, and
          Saturn slowest of all, so if the rule that closer orbits are
          faster holds, then that is their order in distance from the
          Sun.</p>
        <p>Without the faster-is-closer rule, ordering the planets
          beyond Earth by distance is much harder.  You need to the
          quantitative surveying techniques you will learn later to
          make much progress in measuring the geometry of the orbits
          of Mars, Jupiter, and Saturn.</p>
        <p>However, laws like faster-is-closer will always play a
          central role in understanding the positions of planets.
          When you try to chart the solar system, spatial geometry is
          important, but unless your chart shows how the positions of
          the planets change it will be useless.</p>
      </div>
      <div class="question unselectable">How would you test these ideas?</div>
      <div class="answer">
        <p>You can work through the sections in the sidebar menu on
          the left from top to bottom to learn how Johannes Kepler
          tested the hypothesis that the planets orbit the Sun.</p>
        <p>Kepler's brilliant insight was that if the planets move
          around the Sun in <em>periodic</em> orbits - that is,
          tracing the exact same loop at the exact same rate every
          revolution - then you can use them as a surveyor uses
          landmarks to work out their relative distances (which you
          cannot see directly).  He is best remembered for fitting his
          surveyed orbits to formulate his three laws of planetary
          motion, but astronomers had been fitting orbits to
          observations for millenia.  Using surveying techniques to
          map the planets is the crucial original leap Kepler
          made.</p>
      </div>
    </div>
    <div id="orbit-view-help" class="helper hidden">
      [under construction]
    </div>
    <div id="earth-year-help" class="helper hidden">
      [under construction]
    </div>
    <div id="mars-year-help" class="helper hidden">
      [under construction]
    </div>
    <div id="surveyor-help" class="helper hidden">
      [under construction]
    </div>
    <div id="incline-help" class="helper hidden">
      [under construction]
    </div>
    <div id="first-two-r-help" class="helper hidden">
      [under construction]
    </div>
    <div id="third-law-r-help" class="helper hidden">
      [under construction]
    </div>
  </div>

<!-- Load d3 library.  Later should grab only pieces used.
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.4.4/d3.min.js"></script>
-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.4.4/d3.js"></script>
<script src="./ephemeris.js"></script>
<script src="./planetclock.js"></script>
<script>

  const clock = new PlanetClock(d3.select("#top-clock"));
  clock.goToDay(dayOfDate(new Date()));
  clock.hasMoonButton(true);
  clock.disabled = true;
  let introCover = clock.svg.append("foreignObject")
      .attr("xmlns", "http://www.w3.org/1999/xhtml")
      .attr("width", 620).attr("height", 580)
      .attr("x", -310).attr("y", -290);
  introCover.append(() => d3.select("#intro").node());
  const orbits = new OrbitView(d3.select("#orbit-view"), clock);
  const eyear = new EarthYear(d3.select("#earth-year"), clock);
  const myear = new MarsYear(d3.select("#mars-year"), clock);
  const surveyor = new SurveyOrbits(d3.select("#surveyor"), clock, myear, eyear);
  const incline = new Inclination(d3.select("#incline"), clock, surveyor);
  const laws2 = new TwoLaws(d3.select("#first-two-l"),
                            d3.select("#first-two-r"), incline);
  const law3 = new ThirdLaw(d3.select("#third-law-l"),
                            d3.select("#third-law-r"), incline);
  const slaves = {"top-clock": null, "orbit-view": orbits, "earth-year": eyear,
                  "mars-year": myear, "surveyor": surveyor, "incline": incline,
                  "first-two-r": laws2, "third-law-r": law3};

  const hamburger = document.querySelector("#main-hamburger");
  const sidebar = document.querySelector("#main-sidebar");
  const overlay = document.querySelector("#main-overlay");
  function openSidebar() {
    const hamList = hamburger.classList;
    const barList = sidebar.classList;
    if (hamList.contains("holding")) {
      // Usage Overlay active - take overlay down but keep sidebar collapsed.
      hamList.remove("holding", "open");
      const overList = overlay.classList;
      overList.add("faded");
      d3.timeout(() => overList.add("hidden"), 500);
    } else {
      hamList.toggle("open");
      barList.toggle("open");
    }
  }

  let activeAnswer;
  function toggleAnswer() {
    const answer = this.nextElementSibling;
    console.log(this, answer);
    if (activeAnswer) activeAnswer.classList.remove("active");
    if (answer == activeAnswer) {
      activeAnswer = undefined;
    } else {
      answer.classList.add("active");
      activeAnswer = answer;
    }
  }
  document.querySelectorAll(".question").forEach(
    e => { e.onclick = toggleAnswer; });

  function removeIntro() {
    const intro = d3.select("#intro");
    intro.style("transform", "translate(750px, -375px) scale(0.1)");
    hamburger.classList.remove("hidden");
    d3.timeout(
      () => {
        introCover.style("display", "none");
        clock.disabled = false;
      }, 310);
  }

  function restoreIntro() {
    hamburger.classList.remove("hidden");
    const intro = d3.select("#intro");
    introCover.style("display", null);
    d3.timeout(() => intro.style("transform", "translate(0, 0)"), 10);
    d3.timeout(
      () => {
        clock.disabled = true;
      }, 310);
  }

  let currentElem = document.querySelector(".sidebar ul li.current");
  const clockElem = currentElem;
  let currentSlave = null;

  function makeCurrent(elem) {
    if (elem == currentElem) return true;
    hamburger.classList.remove("open");
    sidebar.classList.remove("open");
    if (currentElem) currentElem.classList.remove("current");
    elem.classList.add("current");
    ["mercury", "venus", "jupiter", "saturn"].forEach(
      p => clock.setHandVisibility(p, false));
    const oldDiv = currentElem.dataset.id;
    const newDiv = elem.dataset.id;
    document.querySelector("#"+oldDiv+"-help").classList.add("hidden");
    document.querySelector("#"+newDiv+"-help").classList.remove("hidden");
    const oldDivL = oldDiv.endsWith("-r")? oldDiv.replace("-r", "-l")
          : "top-clock";
    if (oldDiv != "top-clock") {
      const classes = document.querySelector("#"+oldDiv).classList;
      classes.add("shrunken");
      d3.timeout(() => classes.add("hidden"), 300);
      clock.setHandVisibility("mars", true);
    }
    if (currentSlave != null) {
      currentSlave.activate(false);
    }
    currentSlave = slaves[newDiv];
    const newDivL = newDiv.endsWith("-r")? newDiv.replace("-r", "-l")
          : "top-clock";
    if (newDiv != "top-clock") {
      clock.hasMoonButton(false);
      clock.setHandVisibility("mars", true);
      currentSlave.activate(true);
      const classes = document.querySelector("#"+newDiv).classList;
      classes.remove("hidden");
      d3.timeout(() => classes.remove("shrunken"), 10);
    } else {
      clock.removeElapsed();
      clock.hasMoonButton(true);
    }
    if (newDivL != oldDivL) {
      const oldList = document.querySelector("#"+oldDivL).classList;
      const newList = document.querySelector("#"+newDivL).classList;
      oldList.add("faded");  // triggers 0.3s transition
      d3.timeout(() => {  // wait for fade, then fade new div in
        oldList.add("hidden");
        newList.remove("hidden", "faded");
      }, 300);
    }
    currentElem = elem;
    return false;
  }

  function usageClick(elem) {
    hamburger.classList.add("holding");
    sidebar.classList.remove("open");
    overlay.classList.remove("hidden");
    d3.timeout(() => overlay.classList.remove("faded"), 10);
  }

  function clockClick(elem) {
    if (makeCurrent(elem)) {
      hamburger.classList.remove("open");
      sidebar.classList.remove("open");
      restoreIntro();
      return;
    }
  }

  function orbitClick(elem) {
    if (makeCurrent(elem)) return;
  }

  function earthClick(elem) {
    if (makeCurrent(elem)) return;
  }

  function marsClick(elem) {
    if (makeCurrent(elem)) return;
  }

  function surveyClick(elem) {
    if (makeCurrent(elem)) return;
  }

  function inclineClick(elem) {
    if (makeCurrent(elem)) return;
  }

  function twoClick(elem) {
    if (makeCurrent(elem)) return;
  }

  function thirdClick(elem) {
    if (makeCurrent(elem)) return;
  }

</script>


</body>
</html>
